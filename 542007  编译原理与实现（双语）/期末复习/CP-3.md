# 3 词法分析器的实现

## 3.1 词法分析器实现前的准备

- 明确词法分析器的接口
  - 词法分析程序作为编译器的独立一遍（pass）
    - 读入源程序字符序列
    - 生成 token 序列
    - 作为语法分析程序的输入
  - 词法分析程序作为语法分析程序的一个子程序
    - 语法分析程序每调用一次词法分析程序
    - 词法分析器从源程序字符序列识别一个单词
    - 返回 token 值给语法分析程序
- 确定单词的 token 结构
  - 单词的类型（语法信息）
  - 单词的内容（语义信息）
  - 一种可行 token 样例
    - token 结构：（类型，内容）
    - 标识符索引表：（1，单词对应位置）
    - 常量索引表：（2，单词对应位置）
    - 保留字、特殊符号表：（单词对应类型编码，空）

## 3.2 词法分析器的具体实现

- 单词的 DFA 描述及实现
  - 构造每个单词的 DFA
  - 合并各个单词的 DFA
    - 合并初始状态
    - 化简调整状态冲突、对冲突状态重编号
    - 如有必要，增加出错状态
- 针对不同的单词生成对应的 token
  - 标识符的 token 生成
    - 先看保留字、特殊符号表
    - 再看标识符索引表
  - 常量的 token 生成
    - 查找常量索引表
  - 特殊符号 token 生成
    - 查找保留字、特殊符号表

## 3.3 实现词法分析器的注意事项

- 保留字
  - 识别保留字
    - 保留字表
      - 节省空间
    - 自动机单独识别
      - 速度快
      - 自动机状态数随保留字个数增多而急剧增加
- 复合单词：`:=`
- 数的转换：`123`
- 向前看若干个字符的处理：`5 + ++a`
- 控制字符的处理：空格、Tab 和回车换行等
  - 空格、Tab 只是用于分隔单词，可直接删除
  - 回车换行对错误处理起重要作用
- 注释的处理：直接删除
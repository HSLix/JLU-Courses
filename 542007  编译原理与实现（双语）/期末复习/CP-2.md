# 2 形式语言与有限自动机

## 2.1 词法分析概述

- 词法分析器
  - 识别源程序中有独立意义的单词序列
  - 检查源程序的词法错误
- 单词：具有独立意义的最小语义单位
  - 保留字（关键字）：具有特殊意义的单词
  - 标识符：函数名、变量名等
  - 常量：整型常数、实型常数等
  - 特殊符号
    - 运算符
    - 界限符：括号、逗号、分号等
    - 格式符：回车、EOF 等
- 实现
  - 正则表达式
  - 自动机

## 2.2 字符和字符串基本概念

- 字母表（alphabet）

  - 元素的非空有限集合 $\Sigma$
  - 字母表中的一个元素称为一个字母（letter）或符号（symbol）或字符（character）

- 符号串

  - 由字母表中符号组成的任意有穷序列
  - 又称字符串、句子
  - 符号串 $x$ 的长度为 $|x|$
  - 空串为 $\varepsilon$

- 符号串连接

  - $x=abc$，$y=de$
  - $xy=abcde$
  - $|xy|=|x|+|y|$
  - $\varepsilon a=a\varepsilon=a$

- 符号串的方幂

  - $x^0=\varepsilon$
  - $x^1=x$
  - $x^n=x^{n-1}x=xx^{n-1}$

- 符号串集合

  - 所有元素都是某字母表上的符号串
  - 称为该字母表上的符号串集合

- 符号串集合的乘积

  - 符号串集合 $A,B$
  - $AB=\{ab\mid a\in A, b\in B\}$

- 符号串集合的方幂

  - $A^0=\{\varepsilon\}$
  - $A^1=A$
  - $A^n=A^{n-1}A=AA^{n-1}$
  
- 符号串集合的正闭包

  - $A^+=\bigcup\limits_{i=1}^{+\infty}A^i$

- 符号串集合的星闭包

  - $A^*=A^0\cup A^+$

## 2.3 正则表达式定义

- 正则表达式
  - 用来描述正则集的一种代数表达式
  - 又称正规表达式
  - 用来定义一类字符串的一种过滤逻辑
  - 符合正则表达式 $r$ 所定义的规则（模式）的符号串集合称为正则集或正规集 $L(r)$，也称为由 $r$ 定义的语言
  - 递归定义
    - $\varepsilon$ 和 $\varphi$ 是 $\Sigma$ 上的正则表达式，$L(\varepsilon)=\{\varepsilon\}$，$L(\varphi)=\{\}$
    - 对任何 $a\in\Sigma$，$a$ 是 $\Sigma$ 上的正则表达式，则 $L(a)=\{a\}$
    - 若 $r$ 和 $s$ 都是 $\Sigma$ 上的正则表达式
      - $(r)$ 也是 $\Sigma$ 上的正则表达式，$L((r))=L(r)$
      - $r|s$ 也是 $\Sigma$ 上的正则表达式，$L(r|s)=L(r)\cup L(s)$
      - $r\cdot s$ 也是 $\Sigma$ 上的正则表达式，$L(r\cdot s)=L(r)L(s)$，为了方便经常省略 .
      - $r^*$ 也是 $\Sigma$ 上的正则表达式，$L(r^*) = (L(r))^*$
  - 补充运算：$r^+$ 也是 $\Sigma$ 上的正则表达式，$L(r^+)=(L(r))^+$
  - 优先级：$()>*>.>|$

## 2.4 正则表达式描述单词

- 正则表达式性质
  - 交换律：$A|B=B|A$
  - 结合律
    - $A|B|C=(A|B)|C=A|(B|C)$
    - $ABC=(AB)C=A(BC)$
  - 分配律
    - $A(B|C)=AB|AC$
    - $(A|B)C=AC|BC$
  - 幂等律：$A^{**} = A^*$
  - 同一律：$A\varepsilon=\varepsilon A=A$

- 词法分析中的单词描述
  - 保留字：枚举
  - 标识符：$L(L|D)^*$，$L=A|B|\dots|Z|a|b|\dots|z|\_$，$D = 0|1|...|9$
  - 常数
    - 整数：$(+|-|\varepsilon)(D_1D^*)|0$，$D_1=1|2|\dots|9$
    - 实数：$(+|-|\varepsilon)(D_1D^*|0)\cdot D^+$
  - 特殊符号
    - 运算符：枚举
    - 分解符：枚举
    - 控制符：枚举

## 2.5 确定有限自动机 DFA

- 有限自动机 FA（Finite Automata）
  - 能准确识别正规集的装置
  - 确定有限自动机 DFA
  - 非确定有限自动机 NFA
- DFA
  - DFA $M$ 为一个五元组 $M=(S,\Sigma,S_0,f,Z)$
  - $S$：有穷状态集
  - $\Sigma$：有穷字母表
  - $S_0\in S$：唯一的一个初始状态（开始状态）
  - $f$：状态转换函数，$f(S_i,a)=S_k$，$S_k$ 为 $S_i$ 的一个后继状态
  - $Z$：终止状态（可接受状态、结束状态）集
- DFA 的表示方式
  - 状态转换图：有向图
    - 结点
      - 非终止状态：一个圆
      - 终止状态：两个圆
      - 开始状态：一个箭头指向一个圆
    - 边
  - 状态转换矩阵：二维数组
    - 行：所有状态
      - 一般约定第一行为开始状态，或在右上角标注 $+$
      - 终止状态右上角标 $*$ 或 $-$
    - 列：$\Sigma$ 上所有输入字符
- 陷阱状态：无法到达终止状态的状态或未定义的状态
- DFA 的确定性
  - 初始状态唯一
  - $f$ 是单值函数，唯一确定了下一个后继状态
  - 不接受没有输入就进行状态转换的情况

## 2.6 DFA 接受的字符串

- DFA 接受的字符串
  - $\Sigma$ 上的任何字符串 $A=a_1a_2\dots a_n$
  - 若在 DFA $M$ 中存在一条从初始结点到某一终止结点的路径，且路径上所有弧的标记符连成的字符串等于 $A$
  - 称该字符串可被 DFA $M$ 所接受（识别）

- DFA 接受的语言：DFA $M$ 所能接受的字符串的全体 $L(M)$

## 2.7 DFA 描述单词及 DFA 的实现

- 标识符：$L(L|D)^*$，$L=A|B|\dots|Z|a|b|\dots|z|\_$，$D = 0|1|...|9$

- 常数
  - 无符号整数：$D_1D^*|0$，$D_1=1|2|...|9$
  - 带符号整数：$(+|-|\varepsilon)(D_1D^*)|0$
  - 实数：$(+|-|\varepsilon)(D_1D^*|0)\cdot D^+$

- 特殊符号：枚举
- 保留字：枚举
- DFA 的实现方法
  - 直接转向法
  - 基于状态转换矩阵

## 2.8 非确定自动机 NFA

- NFA
  - NFA $A$ 为一个五元组 $A=(S,\Sigma,f,S_0,Z)$
  - $f$：状态转换函数，不要求是单值函数
  - $S_0$：初始状态集
  - 非确定性：
    - 状态转换函数可为多值函数
    - 允许有多个初始状态
    - 允许有 $\varepsilon$ 空边

- NFA 所能接受的语言
  - 设 NFA $A$
  - $L(A)$ 为从任意初始状态到任意终止状态所接受的字符串的集合

## 2.9 NFA 的确定化

- 自动机的等价
  - 设 $A_1$ 和 $A_2$ 是同一字母表 $\Sigma$ 上的自动机
  - 若 $L(A_1)=L(A_2)$，则称 $A_1$ 和 $A_2$ 等价
  - 定理：对任意 NFA $A$ 都存在一个 DFA $A'$ 与之等价

- NFA 到 DFA 的确定化转换算法
  - 子集法
    - 不带 $\varepsilon$ 空边，缩点
    - 状态 $J$ 的 $\varepsilon$ 闭包
      - 设 $J$ 是 NFA $A$ 状态集的子集
      - $J$ 的 $\varepsilon$ 闭包 $\varepsilon\_\mathrm{CLOSURE}(J)$ 为
        - 若 $q\in J$，则 $q\in\varepsilon\_\mathrm{CLOSURE}(J)$
        - 若 $q\in\varepsilon\_\mathrm{CLOSURE}(J)$，从 $q$ 出发经任意条 $\varepsilon$ 边到达的任何状态 $q'$ 都属于 $\varepsilon\_\mathrm{CLOSURE}(J)$
      - 状态集 $I$ 经过输入 $a$ 的转换状态集合
        - 设 $I=\{S_1,S_2,\dots,S_m\}$ 是 NFA 的状态集的子集，对任意输入 $a\in\Sigma$，则 
        -  $I$ 经过输入 $a$ 的转换状态集合 $I_a=\varepsilon\_\mathrm{CLOSURE}(J)$，其中 $J=\bigcup\limits_{i=1}^mf(S_i,a)$
    - 带 $\varepsilon$ 空边，缩点
      - 起始状态为 $\varepsilon\_\mathrm{CLOSURE}(S)$
      - 状态 $A$ 经过输入 $a$ 的后继状态为 $A_a$

## 2.10 DFA 的化简

- 最小自动机
  - DFA $M$ 没有无关状态和等价状态
  - 称 $M$ 为最小（最简）自动机
  - 无关状态：
    - 从起始状态无法到达
    - 从该状态无法到达终止状态
  - 等价状态
    - 对 DFA 中的两个状态 $S_1$ 和 $S_2$
    - 如果将它们看作初始状态，所接受的符号串相同
    - 则定义 $S_1$ 和 $S_2$ 是等价的
  - 两个状态等价的条件
    - 一致性条件：$S_1$ 和 $S_2$ 同时为可接受状态或不可接受状态
    - 蔓延性条件：$S_1$ 和 $S_2$ 对所有输入符号都必须转换到等价状态里

- 状态分离法
  - 初始时，终止状态为一组、非终止状态为一组
  - 对每一组进行分离
    - 若每组中的元素接收 $\Sigma$ 的任意字符会映射到不同的组
    - 则表示它们不等价，可分离出来建立新组
  - 重复分离，直到没有新组产生

## 2.11 正则表达式和有限自动机的相互转化

- 定理
  - 对 $\Sigma$ 上的每一个正则表达式 $R$
  - 存在一个 $\Sigma$ 上的 DFA $M$
  - 使得 $L(M)=L(R)$
- 正则表达式和 NFA 相互转化
  - $ab$：$S_1$ - $a$ - $S_2$ - $b$ - $S_3$
  - $a|b$：$S_1$ - $a,b$ - $S_2,S_3$
  - $b^*$：$S_1$ - $\varepsilon$ - $S_2$ - $b$ - $S_2$ - $\varepsilon$ - $S_3$

